<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="关于功能依赖数据的思考"><meta name="keywords" content="依赖"><meta name="author" content="kazaff,edisondik@gmail.com"><meta name="copyright" content="kazaff"><title>关于功能依赖数据的思考 | kazaff's blog</title><link rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '3.9.0'
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#功能依赖数据"><span class="toc-number">1.</span> <span class="toc-text">功能依赖数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#依赖“倒置”"><span class="toc-number">2.</span> <span class="toc-text">依赖“倒置”</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#结论"><span class="toc-number">3.</span> <span class="toc-text">结论</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.jpg"></div><div class="author-info__name text-center">kazaff</div><div class="author-info__description text-center">coder,leader,tinker</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">198</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">431</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">20</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/banner.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">kazaff's blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">关于功能依赖数据的思考</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 8月 5 2016</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/架构/">架构</a><span class="post-meta__separator">|</span><i class="fa fa-comment-o post-meta__icon" aria-hidden="true"></i><a href="/2016/08/05/关于功能依赖数据的思考/#disqus_thread"><span class="disqus-comment-count" data-disqus-identifier="2016/08/05/关于功能依赖数据的思考/"></span></a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>严格意义上来说，这并不适合称之为架构问题，或者说应该加个范围：业务架构。我不知道这是不是一个通用性问题，至少我在多个项目中不止一次的遇见过这个问题。先来让我简单描述一下问题的具体表现吧~<br><a id="more"></a><br>目前我司正在做的是一个企业内部的ERP系统，在需求分析阶段我们根据企业内部实际的工作流程和角色，在软件系统中引入了预知对应的元素：</p>
<blockquote>
<p>部门 &gt; 用户</p>
</blockquote>
<p>这非常的常规，部门和用户自然也是允许管理员根据企业需要动态的增删改的。目前为止都是美好的！接下来，我们需要根据需求继续将实际工作流程搬到软件中来。假设，我们有N个部门，不同的部门自然对应不同的工种，例如经理，财务，行政，销售等。每个工种都有自己的工作流程和要解决的实际问题。</p>
<p>问题来了，我们要为每个部门开发对应的软件功能，意味着在开发阶段，我们的功能就要确定针对的是哪个部门，这里就产生了依赖。由于“部门”是允许在软件开发完成上线后使用者动态操作的，如何能确保使用者的行为不会打破这种依赖呢？我想这样类似的问题你一定也碰到过，对吧？！</p>
<h2 id="功能依赖数据"><a href="#功能依赖数据" class="headerlink" title="功能依赖数据"></a>功能依赖数据</h2><p>这种依赖只要不解决掉上面提到的那种干扰，就一定是不健全的。但，简单的将“部门”编辑权限关闭，以牺牲用户使用灵活度为代价的方案肯定也是耍流氓，那这中间的权衡应该是什么呢？</p>
<p>让我们撒开欢来思考，如果使用老套路，增加额外的一层来解决被依赖数据的稳定性，是不是一个好的方案呢？</p>
<p>比方说，引入“角色”概念进来，将功能与角色进行关联而不是关联部门，而这里提到的角色是使用者不可变的（注：可能这里叫“角色”容易让大家和权限对应的角色产生关联，但我实在想不出别的好名字，见谅）。</p>
<p>在开发阶段，我们根据需求实现某个业务流程，围绕该流程我们预置所需的角色。换句话说只要该业务流程还在，对应的角色就不会消失。</p>
<p>听起来是个不错的方案，但缺点是，使用者是否能很好的理解“部门”和“角色”的区别和用法？你能确保使用者在创建系统用户的时候很容易的就选择合适的部门和角色么？毕竟现实世界中，部门就足够用了，多出来的角色会让使用者十分的困惑，对他们来说这是个多余的玩意儿！</p>
<p>没错，角色的出发点本身就不是来自于真实需求，更多存在的理由是来自于我们的技术方案，或者说的更直接点，是实际需求和技术方案不匹配导致的。</p>
<p>这个依赖，也是真实的会影响代码的，回想一下以往我们的做法是什么？对于这种功能依赖数据的场景，更多的是使用配置文件，对吧？那现在一般都是前后端分离，意味着相同的配置项，前后端都要各自保存一份（或者提供对应的服务接口）。</p>
<p>总之，前后端最终都会对该配置文件产生强依赖。OMG，越说越可怕，我都不敢往下想了。</p>
<p>绕回刚才的方案，如果我们不引入角色，而是对部门提供额外的约束，例如分成预设部门和普通部门两种类型，预设部门不能编辑。这么做至少我们让使用者不会迷茫了，但依赖的问题还在。</p>
<h2 id="依赖“倒置”"><a href="#依赖“倒置”" class="headerlink" title="依赖“倒置”"></a>依赖“倒置”</h2><p>如果我们将这种依赖关系放手交给使用者来维护的话是否合适呢？思路类似很多框架常用的一种模式，我们提供对应的接口和界面来供使用者完成功能和部门之间的依赖维护，这么做无疑会增加使用者的操作负担，不过也不失为一种灵活可行的方案。但别着急高兴，继续分析。</p>
<p>我们的例子里，若在运行期间修改了功能和部门的关系，那该功能中之前产生的历史数据就有可能不能正常使用，例如由A部门切换到B部门后，原先历史数据中都是A部门下的用户数据，现在都作废了。抛开是否删除这些数据不谈，我们主要关注于这些数据的价值，多数场景下它们都是有价值的。至少，它们曾经代表了系统的一种状态，但它们现在却无法提供太多有意义的信息，甚至会对使用者造成一定程度的视觉干扰。</p>
<p>我们需要根据需求来对待它们，但问题的本质还是依赖改变导致的。如果我们只提供给用户仅一次的依赖绑定操作，之后不允许修改依赖，甚至连被依赖的部门都不能再删除，这又是一种需要权衡的妥协。</p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>这种依赖之所以讨厌，是因为牵扯的面太多，不仅在开发阶段，也在使用阶段。如何最终提供给使用者一个尽可能还原现实世界流程的，不引入陌生概念的方案，该方案还同时可以让开发者能尽可能高效灵活的组织代码，不暴露过多给接口调用方。</p>
<p>可惜，目前，我没有这么样的一个方案。你有么？</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:edisondik@gmail.com">kazaff</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://blog.kazaff.me/2016/08/05/关于功能依赖数据的思考/">https://blog.kazaff.me/2016/08/05/关于功能依赖数据的思考/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/依赖/">依赖</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="/img/weichat.png"><div class="post-qr-code__desc">微信打赏</div></div><div class="post-qr-code-item"><img class="post-qr-code__img" src="/img/alipay.png"><div class="post-qr-code__desc">支付宝打赏</div></div></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2016/08/10/Open-Falcon初探/"><i class="fa fa-chevron-left">  </i><span>Open-Falcon初探</span></a></div><div class="next-post pull-right"><a href="/2016/08/04/AH01071 Got error 'Primary script unknown'/"><span>AH01071 Got Error 'Primary Script Unknown'</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'https://blog.kazaff.me/2016/08/05/关于功能依赖数据的思考/';
  this.page.identifier = '2016/08/05/关于功能依赖数据的思考/';
  this.page.title = '关于功能依赖数据的思考';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'http-blog-kazaff-me' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script><script id="dsq-count-scr" src="https://http-blog-kazaff-me.disqus.com/count.js" async></script></div></div><footer class="footer-bg" style="background-image: url(/img/banner.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2014 - 2021 By kazaff</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>