title: ali云ECS的一次迁移事故
date: 2018-4-3 10:37:12
tags:
- VPC
- DNS
- SSS

categories:
- 运维
---

下午明明还有点瞌睡，可是被ali的ECS升级给我吓了一激灵。本以为会和AWS那样的无痛升级，就没多想立即响应了官方的要求。结果升级完以后一对事儿~
快速把问题记录一下，如果你也碰到了，那就太。。。倒霉了。

### SSH无法访问

这次升级，官方给的介绍是会从ECS会从经典网络环境迁移到专用网络下。迁移后完成后，在ali云web后台可以看到ECS已经运行了，可SSH始终无法链接，跑去VPC安全组一看，**默认阻塞所有的服务器入站请求**，好吧，手动配置安全组规则后搞定。

### ECS无法访问外网

SSH可以登录服务器了，启动所有需要的服务后，发现服务器无法访问外网资源，curl也好，ping也好都统统不行。后来发现是系统的网卡DNS配置问题，改成`8.8.8.8`和`1.1.1.1`解决。

**补充：**
如果使用上面提到的dns的话，我发现系统的yum完全无法使用了，所以只能更换成阿里提供的dns：100.100.2.136, 100.100.2.138


### SSS无法启动

我们服务器上部署着sss服务，用于工作使用，不知道sss的同学可以无视这段。启动失败是因为原先经典网络下的ECS是直接拥有2个网卡的，我们的SSS配置是直接绑定外网IP的。迁移到专用网络后，相当于ECS不再直接拥有那个外网ip。所以，只需要把sss配置绑定ecs的内网ip即可。
