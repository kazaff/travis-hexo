title: Travis CI自动部署Hexo
date: 2016-06-12 09:37:12
tags:
- 持续集成
- hexo
- travis
categories: 运维
---

最近在研究Docker，想搭建开发团队的持续集成（CI）和持续交付（CD）的工作流。之前一直偷懒的安排同事手工部署，后来发现这不是真的“懒”，而是“笨”！！
<!--more-->
不过非运维出身的我，确实要学的东西有太多太多，好在先辈们乐于分享，很容易就可以搜集到大量的相关文献来参考，这真是互联网时代程序员的黄金时代啊！

在开始自动化整个项目之前，先把自己的博客自动化了试试手！但这一篇文章并不是简单重复前辈们说过的话，而是主要记录一下在实测过程中的小坑。

首先，先来看两篇不错的教程贴：

1. [用 Travis CI 自動部署網站到 GitHub](https://zespia.tw/blog/2015/01/21/continuous-deployment-to-github-with-travis/)
1. [利用travis自动部署hexo搭建在github的博客](http://sabrinaluo.com/tech/2015/12/28/travis-github-hexo/)

这两篇文章可以说是相互补充吧，推荐仔细阅读！

根据前面两位前辈的指导，如果你人品好，应该就已经不需要往下阅读了！不过，如果还是一头雾水，那可以看看我是怎么消化上面的内容的。

首先，按照步骤，我们需要在本地环境下安装`Travis`命令，执行：
```
sudo gem install travis
```
你以为你会一切顺利的安装好，那真是太天真了！你可能会碰到机器没有ruby环境，所以没有`gem`命令，那你就需要根据自己的操作系统来安装，或者你也可能和我一样碰到[这个问题](http://stackoverflow.com/questions/15305350/gem-install-fails-with-openssl-failure)，那你就需要执行：
```
gem source -a http://rubygems.org/
```
我并不是ruby用户，所以我不太清楚为啥，总之就这么弄！

你还要记得在生成密匙，在将公有密匙添加到github对应repo中时，记得勾选“**Allow write access**”选项！

然后，根据指导你需要使用`travis`命令来制作私有密匙的加密版本，但之前你最好先创建`.travis.yml`文件，并且让你的终端先进入到你repo的本地路径下，这样该步骤才能找到正确的`.travis.yml`文件（可能不需要手动新建也行，命令会自动创建，不过推荐手动创建，并用博客中提供的模板作为内容）。

这一步搞定以后，会生成加密文件，此时你本地`ssh-keygen`生成的文件已经不需要了，删掉即可。

特别注意的是，上一步自动向`.travis.yml`加的内容会有换行符，需要手动清除掉（这在上面第二篇文章中也有提醒！）。这里我直接给出我使用的[`.travis.yml`](https://github.com/kazaff/travis-hexo/blob/master/.travis.yml)。

由于我是自定义的hexo主题，所以我并没有按照前辈的做法，而是直接将theme也上传到repo中了！

这里有个小插曲，由于我的theme皮肤文件夹是直接从之前的项目中拷贝过来的，其中携带了它自己的`.git`文件夹，导致后面我发现发布后博客都是白页~~呵呵，逗逼！

还要记得，将自己博客的[_config.yml](https://github.com/kazaff/travis-hexo/blob/master/_config.yml)文件中的 **deploy** 设置填写正确的repo地址，否则travis在build时会提示失败的，不过这都很好发觉，只需要观察travis提示的build信息即可！

最后，祝你成功！

---

### 后记
前段时间我的macbook pro被我玩坏了，充不进去电了。难道是装逼遭到报应了吗？！

自己找了家维修店（小城市没有苹果专卖，且笔记本早已过保），检修以后说要替换掉整个主板~~玩儿蛋去吧！

找了个熟人，简直是吊炸天，直接给我把板子上的芯片给更新了，由于我不是搞硬件的，所以我可能无法描述清楚（尽管人家已经给我解释的很仔细了~），感激不尽！！~省去了我将近1000块！真是恩人啊！

这篇文章是笔记本原地复活后的的第一篇，值得留念！

如果有小伙伴遇到了和我一样的问题，可以给我要大牛的联系方式！
